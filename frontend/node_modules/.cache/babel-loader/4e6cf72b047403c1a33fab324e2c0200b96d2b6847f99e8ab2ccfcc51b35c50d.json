{"ast":null,"code":"var _jsxFileName = \"/home/hugorteixeira/AvisoVC/frontend/src/pages/TestFacial.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function TestFacial() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    baselineFace\n  } = useApp();\n  const [status, setStatus] = useState('init'); // init, ready, testing, analyzing, result, error\n  const [testDuration, setTestDuration] = useState(0);\n  const [detectionResult, setDetectionResult] = useState(null);\n  const [currentStatus, setCurrentStatus] = useState('');\n  const [error, setError] = useState(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const timerRef = useRef(null);\n  useEffect(() => {\n    initializeTest();\n    return () => {\n      cleanup();\n    };\n  }, []);\n  const initializeTest = async () => {\n    try {\n      // Check if baseline exists\n      if (!baselineFace) {\n        setError('Voc√™ precisa criar um perfil facial primeiro');\n        setStatus('error');\n        return;\n      }\n\n      // Initialize camera\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: {\n            ideal: 720\n          },\n          height: {\n            ideal: 540\n          }\n        },\n        audio: false\n      });\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = resolve;\n        });\n        await videoRef.current.play();\n\n        // Wait for video to have valid dimensions\n        await new Promise(resolve => {\n          const checkDimensions = () => {\n            if (videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              resolve();\n            } else {\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n        }\n      }\n\n      // Initialize face detector\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n\n      // Load baseline\n      faceDetectorRef.current.loadBaseline(baselineFace);\n      setStatus('ready');\n    } catch (err) {\n      console.error('Failed to initialize test:', err);\n      setError(err.message || 'N√£o foi poss√≠vel iniciar o teste');\n      setStatus('error');\n    }\n  };\n  const handleStartTest = () => {\n    if (!faceDetectorRef.current || !videoRef.current) {\n      setError('Sistema n√£o inicializado');\n      return;\n    }\n    setStatus('testing');\n    setTestDuration(0);\n    setCurrentStatus('Analisando...');\n\n    // Start timer (10 seconds test)\n    timerRef.current = setInterval(() => {\n      setTestDuration(prev => {\n        const newTime = prev + 0.1;\n        if (newTime >= 10) {\n          finishTest();\n        }\n        return newTime;\n      });\n    }, 100);\n\n    // Start detection loop\n    detectLoop();\n  };\n  const detectLoop = () => {\n    if (status === 'analyzing' || status === 'result' || status === 'error') return;\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas === null || canvas === void 0 ? void 0 : canvas.getContext('2d');\n    const detector = faceDetectorRef.current;\n    if (!video || !canvas || !ctx || !detector) return;\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear and draw\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(ctx, result.landmarks, canvas.width, canvas.height, result.status === 'alert');\n        }\n\n        // Update status\n        if (result.status === 'alert') {\n          setCurrentStatus('‚ö†Ô∏è ASSIMETRIA DETECTADA!');\n          setDetectionResult(result);\n        } else if (result.status === 'ok') {\n          setCurrentStatus('‚úì Normal');\n        }\n      } else {\n        setCurrentStatus('Posicione seu rosto na c√¢mera');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n  const finishTest = () => {\n    // Stop timer and animation\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n    setStatus('analyzing');\n\n    // Brief delay to show analyzing state\n    setTimeout(() => {\n      setStatus('result');\n    }, 1000);\n  };\n  const handleContinue = () => {\n    cleanup();\n    if (detectionResult && detectionResult.status === 'alert') {\n      // Skip to results attention\n      navigate('/results-attention');\n    } else {\n      // Continue to next test\n      navigate('/test-arm-right');\n    }\n  };\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n      if (baselineFace) {\n        faceDetectorRef.current.loadBaseline(baselineFace);\n      }\n    }\n    setStatus('ready');\n    setTestDuration(0);\n    setCurrentStatus('');\n    setDetectionResult(null);\n    setError(null);\n  };\n  const cleanup = () => {\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n    }\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n    }\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Inicializando teste facial...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'error') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icon danger\",\n        children: \"\\u26A0\\uFE0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Erro\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button\",\n        onClick: initializeTest,\n        children: \"TENTAR NOVAMENTE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate('/dashboard'),\n        children: \"VOLTAR AO DASHBOARD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'result') {\n    var _detectionResult$skew, _detectionResult$base, _detectionResult$delt;\n    const hasAlert = detectionResult && detectionResult.status === 'alert';\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `icon ${hasAlert ? 'danger' : 'success'}`,\n        children: hasAlert ? '‚ö†Ô∏è' : '‚úì'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"Teste Facial \", hasAlert ? 'COM ALERTA' : 'OK']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `card mt-3 ${hasAlert ? 'alert danger' : 'alert success'}`,\n        children: hasAlert ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Assimetria Facial Detectada\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2\",\n            children: \"O teste detectou uma assimetria significativa em sua express\\xE3o facial. Isso pode ser um sinal de alerta.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 15\n          }, this), detectionResult && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\xCDndice de assimetria:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 22\n              }, this), \" \", (_detectionResult$skew = detectionResult.skewScore) === null || _detectionResult$skew === void 0 ? void 0 : _detectionResult$skew.toFixed(4)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 271,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Baseline:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 22\n              }, this), \" \", (_detectionResult$base = detectionResult.baseline) === null || _detectionResult$base === void 0 ? void 0 : _detectionResult$base.toFixed(4)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 272,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Diferen\\xE7a:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 22\n              }, this), \" \", (_detectionResult$delt = detectionResult.delta) === null || _detectionResult$delt === void 0 ? void 0 : _detectionResult$delt.toFixed(4)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Teste Facial Normal\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2\",\n            children: \"Nenhuma assimetria significativa foi detectada em sua express\\xE3o facial.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), hasAlert ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card mt-2 bg-info\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mb-0\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u26A0\\uFE0F Recomenda\\xE7\\xE3o:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 17\n            }, this), \" Devido ao resultado do teste, recomendamos que voc\\xEA acione a emerg\\xEAncia imediatamente.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button mt-3\",\n          onClick: () => navigate('/results-attention'),\n          children: \"ACIONAR EMERG\\xCANCIA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button white mt-2\",\n          onClick: handleRetry,\n          children: \"REFAZER TESTE\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button green mt-3\",\n          onClick: handleContinue,\n          children: \"CONTINUAR PARA PR\\xD3XIMO TESTE (2/4)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button white mt-2\",\n          onClick: handleRetry,\n          children: \"REFAZER TESTE\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'analyzing') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Analisando Resultados...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-muted\",\n        children: \"Processando dados do teste facial\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Teste FAST 1/4 - Face (Rosto)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-muted\",\n      children: \"Protocolo de Detec\\xE7\\xE3o de AVC\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 7\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Instru\\xE7\\xF5es\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"text-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Sorria\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 17\n          }, this), \" para a c\\xE2mera\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [\"Mantenha o sorriso por \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"10 segundos\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 40\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"O sistema ir\\xE1 detectar se h\\xE1 assimetria facial\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Mantenha o rosto centralizado\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-muted mt-2\",\n        children: /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"Um sorriso assim\\xE9trico pode indicar fraqueza muscular facial\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-container mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }, this), status === 'testing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            top: '20px',\n            left: '50%',\n            transform: 'translateX(-50%)',\n            background: 'rgba(0,0,0,0.8)',\n            padding: '16px 32px',\n            borderRadius: '12px',\n            color: 'white',\n            fontWeight: '600',\n            fontSize: '1.2rem',\n            textAlign: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '2rem',\n              marginBottom: '8px'\n            },\n            children: [testDuration.toFixed(1), \"s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: currentStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 7\n    }, this), status === 'testing' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-bar\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-fill\",\n          style: {\n            width: `${testDuration / 10 * 100}%`,\n            background: (detectionResult === null || detectionResult === void 0 ? void 0 : detectionResult.status) === 'alert' ? 'var(--primary-red)' : 'var(--primary-green)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-center text-muted mt-2\",\n        children: [\"Mantenha o sorriso por \", (10 - testDuration).toFixed(1), \"s\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 9\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button purple mt-3\",\n        onClick: handleStartTest,\n        children: \"\\uD83D\\uDE0A INICIAR TESTE FACIAL\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate('/dashboard'),\n        children: \"CANCELAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 327,\n    columnNumber: 5\n  }, this);\n}\n_s(TestFacial, \"S14sLRXYnhqRl4H29/34eBvo/CY=\", false, function () {\n  return [useNavigate, useApp];\n});\n_c = TestFacial;\nvar _c;\n$RefreshReg$(_c, \"TestFacial\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useApp","FaceDetector","drawLandmarks","jsxDEV","_jsxDEV","Fragment","_Fragment","TestFacial","_s","navigate","baselineFace","status","setStatus","testDuration","setTestDuration","detectionResult","setDetectionResult","currentStatus","setCurrentStatus","error","setError","videoRef","canvasRef","faceDetectorRef","streamRef","animationFrameRef","timerRef","initializeTest","cleanup","stream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","audio","current","srcObject","Promise","resolve","onloadedmetadata","play","checkDimensions","videoWidth","videoHeight","setTimeout","init","loadBaseline","err","console","message","handleStartTest","setInterval","prev","newTime","finishTest","detectLoop","canvas","ctx","getContext","detector","timestamp","performance","now","result","detectFrame","clearRect","drawImage","faceDetected","landmarks","requestAnimationFrame","clearInterval","cancelAnimationFrame","handleContinue","handleRetry","reset","getTracks","forEach","track","stop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_detectionResult$skew","_detectionResult$base","_detectionResult$delt","hasAlert","skewScore","toFixed","baseline","delta","ref","autoPlay","playsInline","muted","style","display","position","top","left","transform","background","padding","borderRadius","color","fontWeight","fontSize","textAlign","marginBottom","_c","$RefreshReg$"],"sources":["/home/hugorteixeira/AvisoVC/frontend/src/pages/TestFacial.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\n\nexport default function TestFacial() {\n  const navigate = useNavigate();\n  const { baselineFace } = useApp();\n\n  const [status, setStatus] = useState('init'); // init, ready, testing, analyzing, result, error\n  const [testDuration, setTestDuration] = useState(0);\n  const [detectionResult, setDetectionResult] = useState(null);\n  const [currentStatus, setCurrentStatus] = useState('');\n  const [error, setError] = useState(null);\n\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const timerRef = useRef(null);\n\n  useEffect(() => {\n    initializeTest();\n    return () => {\n      cleanup();\n    };\n  }, []);\n\n  const initializeTest = async () => {\n    try {\n      // Check if baseline exists\n      if (!baselineFace) {\n        setError('Voc√™ precisa criar um perfil facial primeiro');\n        setStatus('error');\n        return;\n      }\n\n      // Initialize camera\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: { ideal: 720 },\n          height: { ideal: 540 },\n        },\n        audio: false,\n      });\n\n      streamRef.current = stream;\n\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise((resolve) => {\n          videoRef.current.onloadedmetadata = resolve;\n        });\n        await videoRef.current.play();\n\n        // Wait for video to have valid dimensions\n        await new Promise((resolve) => {\n          const checkDimensions = () => {\n            if (videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              resolve();\n            } else {\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n        }\n      }\n\n      // Initialize face detector\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n\n      // Load baseline\n      faceDetectorRef.current.loadBaseline(baselineFace);\n\n      setStatus('ready');\n    } catch (err) {\n      console.error('Failed to initialize test:', err);\n      setError(err.message || 'N√£o foi poss√≠vel iniciar o teste');\n      setStatus('error');\n    }\n  };\n\n  const handleStartTest = () => {\n    if (!faceDetectorRef.current || !videoRef.current) {\n      setError('Sistema n√£o inicializado');\n      return;\n    }\n\n    setStatus('testing');\n    setTestDuration(0);\n    setCurrentStatus('Analisando...');\n\n    // Start timer (10 seconds test)\n    timerRef.current = setInterval(() => {\n      setTestDuration((prev) => {\n        const newTime = prev + 0.1;\n        if (newTime >= 10) {\n          finishTest();\n        }\n        return newTime;\n      });\n    }, 100);\n\n    // Start detection loop\n    detectLoop();\n  };\n\n  const detectLoop = () => {\n    if (status === 'analyzing' || status === 'result' || status === 'error') return;\n\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas?.getContext('2d');\n    const detector = faceDetectorRef.current;\n\n    if (!video || !canvas || !ctx || !detector) return;\n\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear and draw\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(\n            ctx,\n            result.landmarks,\n            canvas.width,\n            canvas.height,\n            result.status === 'alert'\n          );\n        }\n\n        // Update status\n        if (result.status === 'alert') {\n          setCurrentStatus('‚ö†Ô∏è ASSIMETRIA DETECTADA!');\n          setDetectionResult(result);\n        } else if (result.status === 'ok') {\n          setCurrentStatus('‚úì Normal');\n        }\n      } else {\n        setCurrentStatus('Posicione seu rosto na c√¢mera');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n\n  const finishTest = () => {\n    // Stop timer and animation\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n      timerRef.current = null;\n    }\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n\n    setStatus('analyzing');\n\n    // Brief delay to show analyzing state\n    setTimeout(() => {\n      setStatus('result');\n    }, 1000);\n  };\n\n  const handleContinue = () => {\n    cleanup();\n    if (detectionResult && detectionResult.status === 'alert') {\n      // Skip to results attention\n      navigate('/results-attention');\n    } else {\n      // Continue to next test\n      navigate('/test-arm-right');\n    }\n  };\n\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n      if (baselineFace) {\n        faceDetectorRef.current.loadBaseline(baselineFace);\n      }\n    }\n    setStatus('ready');\n    setTestDuration(0);\n    setCurrentStatus('');\n    setDetectionResult(null);\n    setError(null);\n  };\n\n  const cleanup = () => {\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n    }\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => track.stop());\n    }\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return (\n      <div className=\"container\">\n        <div className=\"spinner\"></div>\n        <p>Inicializando teste facial...</p>\n      </div>\n    );\n  }\n\n  if (status === 'error') {\n    return (\n      <div className=\"container\">\n        <div className=\"icon danger\">‚ö†Ô∏è</div>\n        <h1>Erro</h1>\n        <p className=\"text-danger\">{error}</p>\n        <button className=\"button\" onClick={initializeTest}>\n          TENTAR NOVAMENTE\n        </button>\n        <button className=\"button white mt-2\" onClick={() => navigate('/dashboard')}>\n          VOLTAR AO DASHBOARD\n        </button>\n      </div>\n    );\n  }\n\n  if (status === 'result') {\n    const hasAlert = detectionResult && detectionResult.status === 'alert';\n\n    return (\n      <div className=\"container\">\n        <div className={`icon ${hasAlert ? 'danger' : 'success'}`}>\n          {hasAlert ? '‚ö†Ô∏è' : '‚úì'}\n        </div>\n        <h1>Teste Facial {hasAlert ? 'COM ALERTA' : 'OK'}</h1>\n\n        <div className={`card mt-3 ${hasAlert ? 'alert danger' : 'alert success'}`}>\n          {hasAlert ? (\n            <>\n              <h3>Assimetria Facial Detectada</h3>\n              <p className=\"mt-2\">\n                O teste detectou uma assimetria significativa em sua express√£o facial.\n                Isso pode ser um sinal de alerta.\n              </p>\n              {detectionResult && (\n                <div className=\"mt-2\">\n                  <p><strong>√çndice de assimetria:</strong> {detectionResult.skewScore?.toFixed(4)}</p>\n                  <p><strong>Baseline:</strong> {detectionResult.baseline?.toFixed(4)}</p>\n                  <p><strong>Diferen√ßa:</strong> {detectionResult.delta?.toFixed(4)}</p>\n                </div>\n              )}\n            </>\n          ) : (\n            <>\n              <h3>Teste Facial Normal</h3>\n              <p className=\"mt-2\">\n                Nenhuma assimetria significativa foi detectada em sua express√£o facial.\n              </p>\n            </>\n          )}\n        </div>\n\n        {hasAlert ? (\n          <>\n            <div className=\"card mt-2 bg-info\">\n              <p className=\"mb-0\">\n                <strong>‚ö†Ô∏è Recomenda√ß√£o:</strong> Devido ao resultado do teste,\n                recomendamos que voc√™ acione a emerg√™ncia imediatamente.\n              </p>\n            </div>\n            <button className=\"button mt-3\" onClick={() => navigate('/results-attention')}>\n              ACIONAR EMERG√äNCIA\n            </button>\n            <button className=\"button white mt-2\" onClick={handleRetry}>\n              REFAZER TESTE\n            </button>\n          </>\n        ) : (\n          <>\n            <button className=\"button green mt-3\" onClick={handleContinue}>\n              CONTINUAR PARA PR√ìXIMO TESTE (2/4)\n            </button>\n            <button className=\"button white mt-2\" onClick={handleRetry}>\n              REFAZER TESTE\n            </button>\n          </>\n        )}\n      </div>\n    );\n  }\n\n  if (status === 'analyzing') {\n    return (\n      <div className=\"container\">\n        <div className=\"spinner\"></div>\n        <h1>Analisando Resultados...</h1>\n        <p className=\"text-muted\">Processando dados do teste facial</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container\">\n      <h1>Teste FAST 1/4 - Face (Rosto)</h1>\n      <p className=\"text-muted\">Protocolo de Detec√ß√£o de AVC</p>\n\n      {status === 'ready' && (\n        <div className=\"card mt-3\">\n          <h3>Instru√ß√µes</h3>\n          <ul className=\"text-left\">\n            <li><strong>Sorria</strong> para a c√¢mera</li>\n            <li>Mantenha o sorriso por <strong>10 segundos</strong></li>\n            <li>O sistema ir√° detectar se h√° assimetria facial</li>\n            <li>Mantenha o rosto centralizado</li>\n          </ul>\n          <p className=\"text-muted mt-2\">\n            <em>Um sorriso assim√©trico pode indicar fraqueza muscular facial</em>\n          </p>\n        </div>\n      )}\n\n      <div className=\"video-container mt-3\">\n        <video\n          ref={videoRef}\n          autoPlay\n          playsInline\n          muted\n          style={{ display: 'none' }}\n        />\n        <canvas ref={canvasRef} />\n\n        {status === 'testing' && (\n          <div className=\"video-overlay\">\n            <div style={{\n              position: 'absolute',\n              top: '20px',\n              left: '50%',\n              transform: 'translateX(-50%)',\n              background: 'rgba(0,0,0,0.8)',\n              padding: '16px 32px',\n              borderRadius: '12px',\n              color: 'white',\n              fontWeight: '600',\n              fontSize: '1.2rem',\n              textAlign: 'center',\n            }}>\n              <div style={{ fontSize: '2rem', marginBottom: '8px' }}>\n                {testDuration.toFixed(1)}s\n              </div>\n              <div>{currentStatus}</div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {status === 'testing' && (\n        <div className=\"card mt-3\">\n          <div className=\"progress-bar\">\n            <div\n              className=\"progress-fill\"\n              style={{\n                width: `${(testDuration / 10) * 100}%`,\n                background: detectionResult?.status === 'alert'\n                  ? 'var(--primary-red)'\n                  : 'var(--primary-green)'\n              }}\n            ></div>\n          </div>\n          <p className=\"text-center text-muted mt-2\">\n            Mantenha o sorriso por {(10 - testDuration).toFixed(1)}s\n          </p>\n        </div>\n      )}\n\n      {status === 'ready' && (\n        <>\n          <button className=\"button purple mt-3\" onClick={handleStartTest}>\n            üòä INICIAR TESTE FACIAL\n          </button>\n          <button className=\"button white mt-2\" onClick={() => navigate('/dashboard')}>\n            CANCELAR\n          </button>\n        </>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}