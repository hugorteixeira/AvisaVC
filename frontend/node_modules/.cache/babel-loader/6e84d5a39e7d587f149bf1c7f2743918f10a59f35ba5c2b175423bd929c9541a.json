{"ast":null,"code":"var _jsxFileName = \"/home/hugorteixeira/AvisoVC/frontend/src/pages/FaceRecording.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function FaceRecording() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    setBaselineFace\n  } = useApp();\n  const [status, setStatus] = useState('init'); // init, ready, calibrating, complete, error\n  const [progress, setProgress] = useState(0);\n  const [message, setMessage] = useState('Inicializando c√¢mera...');\n  const [error, setError] = useState(null);\n  const [baselineData, setBaselineData] = useState(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  useEffect(() => {\n    initializeCamera();\n    return () => {\n      cleanup();\n    };\n  }, []);\n  const initializeCamera = async () => {\n    try {\n      // Request camera access\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: {\n            ideal: 720\n          },\n          height: {\n            ideal: 540\n          }\n        },\n        audio: false\n      });\n      streamRef.current = stream;\n\n      // Set video source\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = resolve;\n        });\n        await videoRef.current.play();\n\n        // Wait for video to have valid dimensions\n        await new Promise(resolve => {\n          const checkDimensions = () => {\n            if (videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              resolve();\n            } else {\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n\n        // Set canvas size\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n        }\n      }\n\n      // Initialize face detector\n      setMessage('Carregando detector facial...');\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n      setStatus('ready');\n      setMessage('Pronto para iniciar');\n    } catch (err) {\n      console.error('Failed to initialize:', err);\n      setError(err.message || 'N√£o foi poss√≠vel acessar a c√¢mera');\n      setStatus('error');\n    }\n  };\n  const handleStartCalibration = () => {\n    var _videoRef$current, _videoRef$current2;\n    console.log('üé¨ Starting calibration...');\n    console.log('faceDetectorRef:', faceDetectorRef.current);\n    console.log('videoRef:', videoRef.current);\n    console.log('video dimensions:', (_videoRef$current = videoRef.current) === null || _videoRef$current === void 0 ? void 0 : _videoRef$current.videoWidth, 'x', (_videoRef$current2 = videoRef.current) === null || _videoRef$current2 === void 0 ? void 0 : _videoRef$current2.videoHeight);\n    if (!faceDetectorRef.current || !videoRef.current) {\n      console.error('‚ùå Sistema n√£o inicializado');\n      setError('Sistema n√£o inicializado');\n      setStatus('error');\n      return;\n    }\n\n    // Validate video is ready\n    if (videoRef.current.videoWidth === 0 || videoRef.current.videoHeight === 0) {\n      console.error('‚ùå V√≠deo n√£o est√° pronto');\n      setError('V√≠deo ainda n√£o est√° pronto. Aguarde um momento e tente novamente.');\n      setStatus('error');\n      return;\n    }\n    console.log('‚úÖ Starting calibration loop');\n    setStatus('calibrating');\n    setProgress(0);\n    setMessage('Calibrando... Mantenha o rosto centralizado');\n\n    // Start detection loop\n    detectLoop();\n  };\n  const detectLoop = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas === null || canvas === void 0 ? void 0 : canvas.getContext('2d');\n    const detector = faceDetectorRef.current;\n\n    // Stop if required resources are not available\n    if (!video || !canvas || !ctx || !detector) {\n      console.warn('Detection loop stopped: missing resources');\n      return;\n    }\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear canvas and draw video\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(ctx, result.landmarks, canvas.width, canvas.height, result.status === 'alert');\n        }\n\n        // Update UI based on status\n        if (result.status === 'calibrating') {\n          setProgress(result.progress);\n          setMessage(`Calibrando... ${Math.round(result.progress)}%`);\n        } else if (result.status === 'ok' || result.status === 'alert') {\n          // Calibration complete\n          finishCalibration();\n          return;\n        }\n      } else if (result.status === 'no_video') {\n        // Video not ready yet, wait a bit\n        setMessage('Aguardando v√≠deo...');\n      } else {\n        setMessage('Nenhum rosto detectado - centralize seu rosto');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n  const finishCalibration = async () => {\n    if (!faceDetectorRef.current) return;\n    try {\n      // Get baseline data\n      const data = faceDetectorRef.current.getBaselineData();\n      setBaselineData(data);\n\n      // Save to context\n      setBaselineFace(data);\n      setStatus('complete');\n      setMessage('Calibra√ß√£o completa!');\n      setProgress(100);\n\n      // Stop animation loop\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    } catch (err) {\n      console.error('Failed to finish calibration:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n  const handleContinue = () => {\n    cleanup();\n    navigate('/profile-created');\n  };\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n    }\n    setStatus('ready');\n    setProgress(0);\n    setMessage('Pronto para iniciar');\n    setError(null);\n    setBaselineData(null);\n  };\n  const cleanup = () => {\n    // Stop animation loop\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    // Stop camera stream\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n    }\n\n    // Cleanup face detector\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'error') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icon danger\",\n        children: \"\\u26A0\\uFE0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Erro\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button\",\n        onClick: initializeCamera,\n        children: \"TENTAR NOVAMENTE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate(-1),\n        children: \"VOLTAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'complete' && baselineData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icon success\",\n        children: \"\\u2713\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Calibra\\xE7\\xE3o Facial Completa!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mt-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Perfil Facial Criado\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Baseline estabelecida:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 16\n            }, this), \" \", baselineData.mean.toFixed(4)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Frames analisados:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 16\n            }, this), \" \", baselineData.frames]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-muted mt-2\",\n            children: \"Seu perfil facial foi salvo com sucesso. O sistema ir\\xE1 monitorar assimetrias faciais que podem indicar sinais de AVC.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mt-2 bg-info\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mb-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u2139\\uFE0F Importante:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 13\n          }, this), \" Durante o monitoramento, o sistema ir\\xE1 alert\\xE1-lo se detectar qualquer assimetria significativa em sua face.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button green mt-3\",\n        onClick: handleContinue,\n        children: \"CONTINUAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: handleRetry,\n        children: \"REFAZER CALIBRA\\xC7\\xC3O\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress-indicator\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step\",\n        children: \"1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step-line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step active\",\n        children: \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Calibra\\xE7\\xE3o Facial\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-muted\",\n      children: \"Etapa 2 de 2 - Cria\\xE7\\xE3o do Perfil\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Instru\\xE7\\xF5es\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"text-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Posicione seu rosto centralizado na c\\xE2mera\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [\"Mantenha uma express\\xE3o \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"neutra e relaxada\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 40\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Evite movimentar muito a cabe\\xE7a\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Mantenha boa ilumina\\xE7\\xE3o no ambiente\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-muted mt-2\",\n        children: /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"O processo levar\\xE1 cerca de 3-5 segundos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-container mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        style: {\n          display: status === 'calibrating' ? 'none' : 'block'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        style: {\n          display: status === 'calibrating' ? 'block' : 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this), status === 'calibrating' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            top: '20px',\n            left: '50%',\n            transform: 'translateX(-50%)',\n            background: 'rgba(0,0,0,0.7)',\n            padding: '12px 24px',\n            borderRadius: '8px',\n            color: 'white',\n            fontWeight: '600'\n          },\n          children: message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 7\n    }, this), status === 'calibrating' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-bar\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-fill\",\n          style: {\n            width: `${progress}%`,\n            background: 'var(--primary-purple)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-center text-muted mt-2\",\n        children: [Math.round(progress), \"% completo\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 9\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button purple mt-3\",\n        onClick: handleStartCalibration,\n        children: \"\\uD83D\\uDCF9 INICIAR CALIBRA\\xC7\\xC3O\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate(-1),\n        children: \"VOLTAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 292,\n    columnNumber: 5\n  }, this);\n}\n_s(FaceRecording, \"t+xb6LBwUcw/8sRyz0cHlHCNExA=\", false, function () {\n  return [useNavigate, useApp];\n});\n_c = FaceRecording;\nvar _c;\n$RefreshReg$(_c, \"FaceRecording\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useApp","FaceDetector","drawLandmarks","jsxDEV","_jsxDEV","Fragment","_Fragment","FaceRecording","_s","navigate","setBaselineFace","status","setStatus","progress","setProgress","message","setMessage","error","setError","baselineData","setBaselineData","videoRef","canvasRef","faceDetectorRef","streamRef","animationFrameRef","initializeCamera","cleanup","stream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","audio","current","srcObject","Promise","resolve","onloadedmetadata","play","checkDimensions","videoWidth","videoHeight","setTimeout","init","err","console","handleStartCalibration","_videoRef$current","_videoRef$current2","log","detectLoop","canvas","ctx","getContext","detector","warn","timestamp","performance","now","result","detectFrame","clearRect","drawImage","faceDetected","landmarks","Math","round","finishCalibration","requestAnimationFrame","data","getBaselineData","cancelAnimationFrame","handleContinue","handleRetry","reset","getTracks","forEach","track","stop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","mean","toFixed","frames","ref","autoPlay","playsInline","muted","style","display","position","top","left","transform","background","padding","borderRadius","color","fontWeight","_c","$RefreshReg$"],"sources":["/home/hugorteixeira/AvisoVC/frontend/src/pages/FaceRecording.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\n\nexport default function FaceRecording() {\n  const navigate = useNavigate();\n  const { setBaselineFace } = useApp();\n\n  const [status, setStatus] = useState('init'); // init, ready, calibrating, complete, error\n  const [progress, setProgress] = useState(0);\n  const [message, setMessage] = useState('Inicializando c√¢mera...');\n  const [error, setError] = useState(null);\n  const [baselineData, setBaselineData] = useState(null);\n\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n\n  useEffect(() => {\n    initializeCamera();\n    return () => {\n      cleanup();\n    };\n  }, []);\n\n  const initializeCamera = async () => {\n    try {\n      // Request camera access\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: { ideal: 720 },\n          height: { ideal: 540 },\n        },\n        audio: false,\n      });\n\n      streamRef.current = stream;\n\n      // Set video source\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise((resolve) => {\n          videoRef.current.onloadedmetadata = resolve;\n        });\n        await videoRef.current.play();\n\n        // Wait for video to have valid dimensions\n        await new Promise((resolve) => {\n          const checkDimensions = () => {\n            if (videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              resolve();\n            } else {\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n\n        // Set canvas size\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n        }\n      }\n\n      // Initialize face detector\n      setMessage('Carregando detector facial...');\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n\n      setStatus('ready');\n      setMessage('Pronto para iniciar');\n    } catch (err) {\n      console.error('Failed to initialize:', err);\n      setError(err.message || 'N√£o foi poss√≠vel acessar a c√¢mera');\n      setStatus('error');\n    }\n  };\n\n  const handleStartCalibration = () => {\n    console.log('üé¨ Starting calibration...');\n    console.log('faceDetectorRef:', faceDetectorRef.current);\n    console.log('videoRef:', videoRef.current);\n    console.log('video dimensions:', videoRef.current?.videoWidth, 'x', videoRef.current?.videoHeight);\n\n    if (!faceDetectorRef.current || !videoRef.current) {\n      console.error('‚ùå Sistema n√£o inicializado');\n      setError('Sistema n√£o inicializado');\n      setStatus('error');\n      return;\n    }\n\n    // Validate video is ready\n    if (videoRef.current.videoWidth === 0 || videoRef.current.videoHeight === 0) {\n      console.error('‚ùå V√≠deo n√£o est√° pronto');\n      setError('V√≠deo ainda n√£o est√° pronto. Aguarde um momento e tente novamente.');\n      setStatus('error');\n      return;\n    }\n\n    console.log('‚úÖ Starting calibration loop');\n    setStatus('calibrating');\n    setProgress(0);\n    setMessage('Calibrando... Mantenha o rosto centralizado');\n\n    // Start detection loop\n    detectLoop();\n  };\n\n  const detectLoop = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas?.getContext('2d');\n    const detector = faceDetectorRef.current;\n\n    // Stop if required resources are not available\n    if (!video || !canvas || !ctx || !detector) {\n      console.warn('Detection loop stopped: missing resources');\n      return;\n    }\n\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear canvas and draw video\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(\n            ctx,\n            result.landmarks,\n            canvas.width,\n            canvas.height,\n            result.status === 'alert'\n          );\n        }\n\n        // Update UI based on status\n        if (result.status === 'calibrating') {\n          setProgress(result.progress);\n          setMessage(`Calibrando... ${Math.round(result.progress)}%`);\n        } else if (result.status === 'ok' || result.status === 'alert') {\n          // Calibration complete\n          finishCalibration();\n          return;\n        }\n      } else if (result.status === 'no_video') {\n        // Video not ready yet, wait a bit\n        setMessage('Aguardando v√≠deo...');\n      } else {\n        setMessage('Nenhum rosto detectado - centralize seu rosto');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n\n  const finishCalibration = async () => {\n    if (!faceDetectorRef.current) return;\n\n    try {\n      // Get baseline data\n      const data = faceDetectorRef.current.getBaselineData();\n      setBaselineData(data);\n\n      // Save to context\n      setBaselineFace(data);\n\n      setStatus('complete');\n      setMessage('Calibra√ß√£o completa!');\n      setProgress(100);\n\n      // Stop animation loop\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    } catch (err) {\n      console.error('Failed to finish calibration:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n\n  const handleContinue = () => {\n    cleanup();\n    navigate('/profile-created');\n  };\n\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n    }\n    setStatus('ready');\n    setProgress(0);\n    setMessage('Pronto para iniciar');\n    setError(null);\n    setBaselineData(null);\n  };\n\n  const cleanup = () => {\n    // Stop animation loop\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    // Stop camera stream\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => track.stop());\n    }\n\n    // Cleanup face detector\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return (\n      <div className=\"container\">\n        <div className=\"spinner\"></div>\n        <p>{message}</p>\n      </div>\n    );\n  }\n\n  if (status === 'error') {\n    return (\n      <div className=\"container\">\n        <div className=\"icon danger\">‚ö†Ô∏è</div>\n        <h1>Erro</h1>\n        <p className=\"text-danger\">{error}</p>\n        <button className=\"button\" onClick={initializeCamera}>\n          TENTAR NOVAMENTE\n        </button>\n        <button className=\"button white mt-2\" onClick={() => navigate(-1)}>\n          VOLTAR\n        </button>\n      </div>\n    );\n  }\n\n  if (status === 'complete' && baselineData) {\n    return (\n      <div className=\"container\">\n        <div className=\"icon success\">‚úì</div>\n        <h1>Calibra√ß√£o Facial Completa!</h1>\n\n        <div className=\"card mt-3\">\n          <h3>Perfil Facial Criado</h3>\n          <div className=\"mt-2\">\n            <p><strong>Baseline estabelecida:</strong> {baselineData.mean.toFixed(4)}</p>\n            <p><strong>Frames analisados:</strong> {baselineData.frames}</p>\n            <p className=\"text-muted mt-2\">\n              Seu perfil facial foi salvo com sucesso. O sistema ir√° monitorar assimetrias\n              faciais que podem indicar sinais de AVC.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"card mt-2 bg-info\">\n          <p className=\"mb-0\">\n            <strong>‚ÑπÔ∏è Importante:</strong> Durante o monitoramento, o sistema ir√° alert√°-lo\n            se detectar qualquer assimetria significativa em sua face.\n          </p>\n        </div>\n\n        <button className=\"button green mt-3\" onClick={handleContinue}>\n          CONTINUAR\n        </button>\n        <button className=\"button white mt-2\" onClick={handleRetry}>\n          REFAZER CALIBRA√á√ÉO\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container\">\n      <div className=\"progress-indicator\">\n        <div className=\"step\">1</div>\n        <div className=\"step-line\"></div>\n        <div className=\"step active\">2</div>\n      </div>\n\n      <h1>Calibra√ß√£o Facial</h1>\n      <p className=\"text-muted\">Etapa 2 de 2 - Cria√ß√£o do Perfil</p>\n\n      {status === 'ready' && (\n        <div className=\"card mt-3\">\n          <h3>Instru√ß√µes</h3>\n          <ul className=\"text-left\">\n            <li>Posicione seu rosto centralizado na c√¢mera</li>\n            <li>Mantenha uma express√£o <strong>neutra e relaxada</strong></li>\n            <li>Evite movimentar muito a cabe√ßa</li>\n            <li>Mantenha boa ilumina√ß√£o no ambiente</li>\n          </ul>\n          <p className=\"text-muted mt-2\">\n            <em>O processo levar√° cerca de 3-5 segundos</em>\n          </p>\n        </div>\n      )}\n\n      <div className=\"video-container mt-3\">\n        <video\n          ref={videoRef}\n          autoPlay\n          playsInline\n          muted\n          style={{ display: status === 'calibrating' ? 'none' : 'block' }}\n        />\n        <canvas\n          ref={canvasRef}\n          style={{ display: status === 'calibrating' ? 'block' : 'none' }}\n        />\n\n        {status === 'calibrating' && (\n          <div className=\"video-overlay\">\n            <div style={{\n              position: 'absolute',\n              top: '20px',\n              left: '50%',\n              transform: 'translateX(-50%)',\n              background: 'rgba(0,0,0,0.7)',\n              padding: '12px 24px',\n              borderRadius: '8px',\n              color: 'white',\n              fontWeight: '600',\n            }}>\n              {message}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {status === 'calibrating' && (\n        <div className=\"card mt-3\">\n          <div className=\"progress-bar\">\n            <div\n              className=\"progress-fill\"\n              style={{ width: `${progress}%`, background: 'var(--primary-purple)' }}\n            ></div>\n          </div>\n          <p className=\"text-center text-muted mt-2\">{Math.round(progress)}% completo</p>\n        </div>\n      )}\n\n      {status === 'ready' && (\n        <>\n          <button className=\"button purple mt-3\" onClick={handleStartCalibration}>\n            üìπ INICIAR CALIBRA√á√ÉO\n          </button>\n          <button className=\"button white mt-2\" onClick={() => navigate(-1)}>\n            VOLTAR\n          </button>\n        </>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}