{"ast":null,"code":"var _jsxFileName = \"/home/hugorteixeira/AvisoVC/frontend/src/pages/FaceRecording.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function FaceRecording() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    setBaselineFace\n  } = useApp();\n  const [status, setStatus] = useState('init'); // init, ready, calibrating, complete, error\n  const [progress, setProgress] = useState(0);\n  const [message, setMessage] = useState('Inicializando c√¢mera...');\n  const [error, setError] = useState(null);\n  const [baselineData, setBaselineData] = useState(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  useEffect(() => {\n    initializeCamera();\n    return () => {\n      cleanup();\n    };\n  }, []);\n  const initializeCamera = async () => {\n    try {\n      console.log('üé¨ Initializing face recording camera...');\n\n      // Request camera access\n      console.log('üìπ Requesting camera access...');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: {\n            ideal: 720\n          },\n          height: {\n            ideal: 540\n          }\n        },\n        audio: false\n      });\n      console.log('‚úÖ Camera access granted');\n      streamRef.current = stream;\n\n      // Set video source\n      if (videoRef.current) {\n        console.log('üé• Setting up video element...');\n        videoRef.current.srcObject = stream;\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = () => {\n            console.log('‚úÖ Video metadata loaded');\n            resolve();\n          };\n        });\n        await videoRef.current.play();\n        console.log('‚úÖ Video playing');\n\n        // Wait for video to have valid dimensions\n        console.log('‚è≥ Waiting for video dimensions...');\n        await new Promise((resolve, reject) => {\n          let attempts = 0;\n          const maxAttempts = 50; // 5 seconds max\n          const checkDimensions = () => {\n            attempts++;\n            if (videoRef.current && videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              console.log(`‚úÖ Video dimensions: ${videoRef.current.videoWidth}x${videoRef.current.videoHeight}`);\n              resolve();\n            } else if (attempts >= maxAttempts) {\n              console.error(`‚ùå Timeout waiting for video dimensions after ${attempts} attempts`);\n              reject(new Error('Timeout esperando dimens√µes do v√≠deo. Tente recarregar a p√°gina.'));\n            } else {\n              console.log(`‚è≥ Video dimensions not ready yet... (attempt ${attempts}/${maxAttempts})`);\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n\n        // Set canvas size\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n          console.log(`‚úÖ Canvas set to ${canvasRef.current.width}x${canvasRef.current.height}`);\n        }\n      }\n\n      // Initialize face detector\n      setMessage('Carregando detector facial...');\n      console.log('ü§ñ Initializing face detector...');\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n      console.log('‚úÖ Face detector initialized');\n      setStatus('ready');\n      setMessage('Pronto para iniciar');\n      console.log('‚úÖ Face recording ready!');\n    } catch (err) {\n      console.error('‚ùå Failed to initialize:', err);\n      setError(err.message || 'N√£o foi poss√≠vel acessar a c√¢mera');\n      setStatus('error');\n    }\n  };\n  const handleStartCalibration = () => {\n    var _videoRef$current, _videoRef$current2;\n    console.log('üé¨ Starting calibration...');\n    console.log('faceDetectorRef:', faceDetectorRef.current);\n    console.log('videoRef:', videoRef.current);\n    console.log('video dimensions:', (_videoRef$current = videoRef.current) === null || _videoRef$current === void 0 ? void 0 : _videoRef$current.videoWidth, 'x', (_videoRef$current2 = videoRef.current) === null || _videoRef$current2 === void 0 ? void 0 : _videoRef$current2.videoHeight);\n    if (!faceDetectorRef.current || !videoRef.current) {\n      console.error('‚ùå Sistema n√£o inicializado');\n      setError('Sistema n√£o inicializado');\n      setStatus('error');\n      return;\n    }\n\n    // Validate video is ready\n    if (videoRef.current.videoWidth === 0 || videoRef.current.videoHeight === 0) {\n      console.error('‚ùå V√≠deo n√£o est√° pronto');\n      setError('V√≠deo ainda n√£o est√° pronto. Aguarde um momento e tente novamente.');\n      setStatus('error');\n      return;\n    }\n    console.log('‚úÖ Starting calibration loop');\n    setStatus('calibrating');\n    setProgress(0);\n    setMessage('Calibrando... Mantenha o rosto centralizado');\n\n    // Start detection loop\n    detectLoop();\n  };\n  const detectLoop = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas === null || canvas === void 0 ? void 0 : canvas.getContext('2d');\n    const detector = faceDetectorRef.current;\n\n    // Stop if required resources are not available\n    if (!video || !canvas || !ctx || !detector) {\n      console.warn('Detection loop stopped: missing resources');\n      return;\n    }\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear canvas and draw video\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(ctx, result.landmarks, canvas.width, canvas.height, result.status === 'alert');\n        }\n\n        // Update UI based on status\n        if (result.status === 'calibrating') {\n          setProgress(result.progress);\n          setMessage(`Calibrando... ${Math.round(result.progress)}%`);\n        } else if (result.status === 'ok' || result.status === 'alert') {\n          // Calibration complete\n          finishCalibration();\n          return;\n        }\n      } else if (result.status === 'no_video') {\n        // Video not ready yet, wait a bit\n        setMessage('Aguardando v√≠deo...');\n      } else {\n        setMessage('Nenhum rosto detectado - centralize seu rosto');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n  const finishCalibration = async () => {\n    if (!faceDetectorRef.current) return;\n    try {\n      // Get baseline data\n      const data = faceDetectorRef.current.getBaselineData();\n      setBaselineData(data);\n\n      // Save to context\n      setBaselineFace(data);\n      setStatus('complete');\n      setMessage('Calibra√ß√£o completa!');\n      setProgress(100);\n\n      // Stop animation loop\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    } catch (err) {\n      console.error('Failed to finish calibration:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n  const handleContinue = () => {\n    cleanup();\n    navigate('/profile-created');\n  };\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n    }\n    setStatus('ready');\n    setProgress(0);\n    setMessage('Pronto para iniciar');\n    setError(null);\n    setBaselineData(null);\n  };\n  const cleanup = () => {\n    // Stop animation loop\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    // Stop camera stream\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n    }\n\n    // Cleanup face detector\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'error') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icon danger\",\n        children: \"\\u26A0\\uFE0F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Erro\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-danger\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button\",\n        onClick: initializeCamera,\n        children: \"TENTAR NOVAMENTE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate(-1),\n        children: \"VOLTAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, this);\n  }\n  if (status === 'complete' && baselineData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icon success\",\n        children: \"\\u2713\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Calibra\\xE7\\xE3o Facial Completa!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mt-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Perfil Facial Criado\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Baseline estabelecida:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 16\n            }, this), \" \", baselineData.mean.toFixed(4)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Frames analisados:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 16\n            }, this), \" \", baselineData.frames]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-muted mt-2\",\n            children: \"Seu perfil facial foi salvo com sucesso. O sistema ir\\xE1 monitorar assimetrias faciais que podem indicar sinais de AVC.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mt-2 bg-info\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mb-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u2139\\uFE0F Importante:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this), \" Durante o monitoramento, o sistema ir\\xE1 alert\\xE1-lo se detectar qualquer assimetria significativa em sua face.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button green mt-3\",\n        onClick: handleContinue,\n        children: \"CONTINUAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: handleRetry,\n        children: \"REFAZER CALIBRA\\xC7\\xC3O\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"progress-indicator\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step\",\n        children: \"1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step-line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"step active\",\n        children: \"2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Calibra\\xE7\\xE3o Facial\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-muted\",\n      children: \"Etapa 2 de 2 - Cria\\xE7\\xE3o do Perfil\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 7\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Instru\\xE7\\xF5es\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"text-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Posicione seu rosto centralizado na c\\xE2mera\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [\"Mantenha uma express\\xE3o \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"neutra e relaxada\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 40\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Evite movimentar muito a cabe\\xE7a\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Mantenha boa ilumina\\xE7\\xE3o no ambiente\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-muted mt-2\",\n        children: /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"O processo levar\\xE1 cerca de 3-5 segundos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-container mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        style: {\n          display: status === 'calibrating' ? 'none' : 'block'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        style: {\n          display: status === 'calibrating' ? 'block' : 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            bottom: '20px',\n            left: '50%',\n            transform: 'translateX(-50%)',\n            background: 'rgba(0,0,0,0.7)',\n            padding: '12px 24px',\n            borderRadius: '8px',\n            color: 'white',\n            fontWeight: '600',\n            textAlign: 'center'\n          },\n          children: \"\\uD83D\\uDCF9 C\\xE2mera ativa - Pronto para iniciar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 11\n      }, this), status === 'calibrating' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            top: '20px',\n            left: '50%',\n            transform: 'translateX(-50%)',\n            background: 'rgba(0,0,0,0.7)',\n            padding: '12px 24px',\n            borderRadius: '8px',\n            color: 'white',\n            fontWeight: '600'\n          },\n          children: message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 7\n    }, this), status === 'calibrating' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card mt-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-bar\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-fill\",\n          style: {\n            width: `${progress}%`,\n            background: 'var(--primary-purple)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-center text-muted mt-2\",\n        children: [Math.round(progress), \"% completo\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 9\n    }, this), status === 'ready' && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button purple mt-3\",\n        onClick: handleStartCalibration,\n        children: \"\\uD83D\\uDCF9 INICIAR CALIBRA\\xC7\\xC3O\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"button white mt-2\",\n        onClick: () => navigate(-1),\n        children: \"VOLTAR\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 314,\n    columnNumber: 5\n  }, this);\n}\n_s(FaceRecording, \"t+xb6LBwUcw/8sRyz0cHlHCNExA=\", false, function () {\n  return [useNavigate, useApp];\n});\n_c = FaceRecording;\nvar _c;\n$RefreshReg$(_c, \"FaceRecording\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useApp","FaceDetector","drawLandmarks","jsxDEV","_jsxDEV","Fragment","_Fragment","FaceRecording","_s","navigate","setBaselineFace","status","setStatus","progress","setProgress","message","setMessage","error","setError","baselineData","setBaselineData","videoRef","canvasRef","faceDetectorRef","streamRef","animationFrameRef","initializeCamera","cleanup","console","log","stream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","audio","current","srcObject","Promise","resolve","onloadedmetadata","play","reject","attempts","maxAttempts","checkDimensions","videoWidth","videoHeight","Error","setTimeout","init","err","handleStartCalibration","_videoRef$current","_videoRef$current2","detectLoop","canvas","ctx","getContext","detector","warn","timestamp","performance","now","result","detectFrame","clearRect","drawImage","faceDetected","landmarks","Math","round","finishCalibration","requestAnimationFrame","data","getBaselineData","cancelAnimationFrame","handleContinue","handleRetry","reset","getTracks","forEach","track","stop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","mean","toFixed","frames","ref","autoPlay","playsInline","muted","style","display","position","bottom","left","transform","background","padding","borderRadius","color","fontWeight","textAlign","top","_c","$RefreshReg$"],"sources":["/home/hugorteixeira/AvisoVC/frontend/src/pages/FaceRecording.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useApp } from '../contexts/AppContext';\nimport { FaceDetector, drawLandmarks } from '../utils/faceDetection';\n\nexport default function FaceRecording() {\n  const navigate = useNavigate();\n  const { setBaselineFace } = useApp();\n\n  const [status, setStatus] = useState('init'); // init, ready, calibrating, complete, error\n  const [progress, setProgress] = useState(0);\n  const [message, setMessage] = useState('Inicializando c√¢mera...');\n  const [error, setError] = useState(null);\n  const [baselineData, setBaselineData] = useState(null);\n\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const faceDetectorRef = useRef(null);\n  const streamRef = useRef(null);\n  const animationFrameRef = useRef(null);\n\n  useEffect(() => {\n    initializeCamera();\n    return () => {\n      cleanup();\n    };\n  }, []);\n\n  const initializeCamera = async () => {\n    try {\n      console.log('üé¨ Initializing face recording camera...');\n\n      // Request camera access\n      console.log('üìπ Requesting camera access...');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: { ideal: 720 },\n          height: { ideal: 540 },\n        },\n        audio: false,\n      });\n      console.log('‚úÖ Camera access granted');\n\n      streamRef.current = stream;\n\n      // Set video source\n      if (videoRef.current) {\n        console.log('üé• Setting up video element...');\n        videoRef.current.srcObject = stream;\n        await new Promise((resolve) => {\n          videoRef.current.onloadedmetadata = () => {\n            console.log('‚úÖ Video metadata loaded');\n            resolve();\n          };\n        });\n        await videoRef.current.play();\n        console.log('‚úÖ Video playing');\n\n        // Wait for video to have valid dimensions\n        console.log('‚è≥ Waiting for video dimensions...');\n        await new Promise((resolve, reject) => {\n          let attempts = 0;\n          const maxAttempts = 50; // 5 seconds max\n          const checkDimensions = () => {\n            attempts++;\n            if (videoRef.current && videoRef.current.videoWidth > 0 && videoRef.current.videoHeight > 0) {\n              console.log(`‚úÖ Video dimensions: ${videoRef.current.videoWidth}x${videoRef.current.videoHeight}`);\n              resolve();\n            } else if (attempts >= maxAttempts) {\n              console.error(`‚ùå Timeout waiting for video dimensions after ${attempts} attempts`);\n              reject(new Error('Timeout esperando dimens√µes do v√≠deo. Tente recarregar a p√°gina.'));\n            } else {\n              console.log(`‚è≥ Video dimensions not ready yet... (attempt ${attempts}/${maxAttempts})`);\n              setTimeout(checkDimensions, 100);\n            }\n          };\n          checkDimensions();\n        });\n\n        // Set canvas size\n        if (canvasRef.current) {\n          canvasRef.current.width = videoRef.current.videoWidth;\n          canvasRef.current.height = videoRef.current.videoHeight;\n          console.log(`‚úÖ Canvas set to ${canvasRef.current.width}x${canvasRef.current.height}`);\n        }\n      }\n\n      // Initialize face detector\n      setMessage('Carregando detector facial...');\n      console.log('ü§ñ Initializing face detector...');\n      faceDetectorRef.current = new FaceDetector();\n      await faceDetectorRef.current.init();\n      console.log('‚úÖ Face detector initialized');\n\n      setStatus('ready');\n      setMessage('Pronto para iniciar');\n      console.log('‚úÖ Face recording ready!');\n    } catch (err) {\n      console.error('‚ùå Failed to initialize:', err);\n      setError(err.message || 'N√£o foi poss√≠vel acessar a c√¢mera');\n      setStatus('error');\n    }\n  };\n\n  const handleStartCalibration = () => {\n    console.log('üé¨ Starting calibration...');\n    console.log('faceDetectorRef:', faceDetectorRef.current);\n    console.log('videoRef:', videoRef.current);\n    console.log('video dimensions:', videoRef.current?.videoWidth, 'x', videoRef.current?.videoHeight);\n\n    if (!faceDetectorRef.current || !videoRef.current) {\n      console.error('‚ùå Sistema n√£o inicializado');\n      setError('Sistema n√£o inicializado');\n      setStatus('error');\n      return;\n    }\n\n    // Validate video is ready\n    if (videoRef.current.videoWidth === 0 || videoRef.current.videoHeight === 0) {\n      console.error('‚ùå V√≠deo n√£o est√° pronto');\n      setError('V√≠deo ainda n√£o est√° pronto. Aguarde um momento e tente novamente.');\n      setStatus('error');\n      return;\n    }\n\n    console.log('‚úÖ Starting calibration loop');\n    setStatus('calibrating');\n    setProgress(0);\n    setMessage('Calibrando... Mantenha o rosto centralizado');\n\n    // Start detection loop\n    detectLoop();\n  };\n\n  const detectLoop = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas?.getContext('2d');\n    const detector = faceDetectorRef.current;\n\n    // Stop if required resources are not available\n    if (!video || !canvas || !ctx || !detector) {\n      console.warn('Detection loop stopped: missing resources');\n      return;\n    }\n\n    try {\n      const timestamp = performance.now();\n      const result = detector.detectFrame(video, timestamp);\n\n      // Clear canvas and draw video\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n      if (result.faceDetected) {\n        // Draw landmarks\n        if (result.landmarks) {\n          drawLandmarks(\n            ctx,\n            result.landmarks,\n            canvas.width,\n            canvas.height,\n            result.status === 'alert'\n          );\n        }\n\n        // Update UI based on status\n        if (result.status === 'calibrating') {\n          setProgress(result.progress);\n          setMessage(`Calibrando... ${Math.round(result.progress)}%`);\n        } else if (result.status === 'ok' || result.status === 'alert') {\n          // Calibration complete\n          finishCalibration();\n          return;\n        }\n      } else if (result.status === 'no_video') {\n        // Video not ready yet, wait a bit\n        setMessage('Aguardando v√≠deo...');\n      } else {\n        setMessage('Nenhum rosto detectado - centralize seu rosto');\n      }\n\n      // Continue loop\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\n    } catch (err) {\n      console.error('Detection error:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n\n  const finishCalibration = async () => {\n    if (!faceDetectorRef.current) return;\n\n    try {\n      // Get baseline data\n      const data = faceDetectorRef.current.getBaselineData();\n      setBaselineData(data);\n\n      // Save to context\n      setBaselineFace(data);\n\n      setStatus('complete');\n      setMessage('Calibra√ß√£o completa!');\n      setProgress(100);\n\n      // Stop animation loop\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    } catch (err) {\n      console.error('Failed to finish calibration:', err);\n      setError(err.message);\n      setStatus('error');\n    }\n  };\n\n  const handleContinue = () => {\n    cleanup();\n    navigate('/profile-created');\n  };\n\n  const handleRetry = () => {\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.reset();\n    }\n    setStatus('ready');\n    setProgress(0);\n    setMessage('Pronto para iniciar');\n    setError(null);\n    setBaselineData(null);\n  };\n\n  const cleanup = () => {\n    // Stop animation loop\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    // Stop camera stream\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => track.stop());\n    }\n\n    // Cleanup face detector\n    if (faceDetectorRef.current) {\n      faceDetectorRef.current.cleanup();\n    }\n  };\n\n  // Render states\n  if (status === 'init') {\n    return (\n      <div className=\"container\">\n        <div className=\"spinner\"></div>\n        <p>{message}</p>\n      </div>\n    );\n  }\n\n  if (status === 'error') {\n    return (\n      <div className=\"container\">\n        <div className=\"icon danger\">‚ö†Ô∏è</div>\n        <h1>Erro</h1>\n        <p className=\"text-danger\">{error}</p>\n        <button className=\"button\" onClick={initializeCamera}>\n          TENTAR NOVAMENTE\n        </button>\n        <button className=\"button white mt-2\" onClick={() => navigate(-1)}>\n          VOLTAR\n        </button>\n      </div>\n    );\n  }\n\n  if (status === 'complete' && baselineData) {\n    return (\n      <div className=\"container\">\n        <div className=\"icon success\">‚úì</div>\n        <h1>Calibra√ß√£o Facial Completa!</h1>\n\n        <div className=\"card mt-3\">\n          <h3>Perfil Facial Criado</h3>\n          <div className=\"mt-2\">\n            <p><strong>Baseline estabelecida:</strong> {baselineData.mean.toFixed(4)}</p>\n            <p><strong>Frames analisados:</strong> {baselineData.frames}</p>\n            <p className=\"text-muted mt-2\">\n              Seu perfil facial foi salvo com sucesso. O sistema ir√° monitorar assimetrias\n              faciais que podem indicar sinais de AVC.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"card mt-2 bg-info\">\n          <p className=\"mb-0\">\n            <strong>‚ÑπÔ∏è Importante:</strong> Durante o monitoramento, o sistema ir√° alert√°-lo\n            se detectar qualquer assimetria significativa em sua face.\n          </p>\n        </div>\n\n        <button className=\"button green mt-3\" onClick={handleContinue}>\n          CONTINUAR\n        </button>\n        <button className=\"button white mt-2\" onClick={handleRetry}>\n          REFAZER CALIBRA√á√ÉO\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container\">\n      <div className=\"progress-indicator\">\n        <div className=\"step\">1</div>\n        <div className=\"step-line\"></div>\n        <div className=\"step active\">2</div>\n      </div>\n\n      <h1>Calibra√ß√£o Facial</h1>\n      <p className=\"text-muted\">Etapa 2 de 2 - Cria√ß√£o do Perfil</p>\n\n      {status === 'ready' && (\n        <div className=\"card mt-3\">\n          <h3>Instru√ß√µes</h3>\n          <ul className=\"text-left\">\n            <li>Posicione seu rosto centralizado na c√¢mera</li>\n            <li>Mantenha uma express√£o <strong>neutra e relaxada</strong></li>\n            <li>Evite movimentar muito a cabe√ßa</li>\n            <li>Mantenha boa ilumina√ß√£o no ambiente</li>\n          </ul>\n          <p className=\"text-muted mt-2\">\n            <em>O processo levar√° cerca de 3-5 segundos</em>\n          </p>\n        </div>\n      )}\n\n      <div className=\"video-container mt-3\">\n        <video\n          ref={videoRef}\n          autoPlay\n          playsInline\n          muted\n          style={{ display: status === 'calibrating' ? 'none' : 'block' }}\n        />\n        <canvas\n          ref={canvasRef}\n          style={{ display: status === 'calibrating' ? 'block' : 'none' }}\n        />\n\n        {status === 'ready' && (\n          <div className=\"video-overlay\">\n            <div style={{\n              position: 'absolute',\n              bottom: '20px',\n              left: '50%',\n              transform: 'translateX(-50%)',\n              background: 'rgba(0,0,0,0.7)',\n              padding: '12px 24px',\n              borderRadius: '8px',\n              color: 'white',\n              fontWeight: '600',\n              textAlign: 'center',\n            }}>\n              üìπ C√¢mera ativa - Pronto para iniciar\n            </div>\n          </div>\n        )}\n\n        {status === 'calibrating' && (\n          <div className=\"video-overlay\">\n            <div style={{\n              position: 'absolute',\n              top: '20px',\n              left: '50%',\n              transform: 'translateX(-50%)',\n              background: 'rgba(0,0,0,0.7)',\n              padding: '12px 24px',\n              borderRadius: '8px',\n              color: 'white',\n              fontWeight: '600',\n            }}>\n              {message}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {status === 'calibrating' && (\n        <div className=\"card mt-3\">\n          <div className=\"progress-bar\">\n            <div\n              className=\"progress-fill\"\n              style={{ width: `${progress}%`, background: 'var(--primary-purple)' }}\n            ></div>\n          </div>\n          <p className=\"text-center text-muted mt-2\">{Math.round(progress)}% completo</p>\n        </div>\n      )}\n\n      {status === 'ready' && (\n        <>\n          <button className=\"button purple mt-3\" onClick={handleStartCalibration}>\n            üìπ INICIAR CALIBRA√á√ÉO\n          </button>\n          <button className=\"button white mt-2\" onClick={() => navigate(-1)}>\n            VOLTAR\n          </button>\n        </>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}